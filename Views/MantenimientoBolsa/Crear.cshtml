@model MantenimientoBolsaViewModel

@{
    ViewData["Title"] = "Dar de alta a bolsa";
}

<div class="text-center my-3">
    <h1>Mantenimiento de Bolsa</h1>
    <p class="text-muted">Utiliza este formulario para gestionar los vacantes de la bolsa de trabajo.</p>
</div>

<div asp-validation-summary="ModelOnly" class="text-danger"></div>

<main class="container-fluid p-0">
    
    <form method="post">
        <section class="row border shadow bg-gradient text-white" style="background-color: #133E87">
            <div class="col-3">
                <img src="@Url.Content("~/images/MenuCatalogos/Puesto.jpg")" alt="Demostración" class="img-fluid w-100 rounded-0" style="object-fit: cover; height: 100%;" />
            </div>
            <div class="col p-5">
                <div class="d-flex flex-column text-center">
                    <i class="bi bi-person text-white fs-1"></i>
                    <h1>Vacantes</h1>
                </div>
                <h4 class="mb-4">Datos Personales</h4>
                <!-- Datos personales -->
                <div class="row mb-3">
                    <div class="col-md-3">
                        <label for="Clave" class="form-label">Clave</label>
                        <input id="Clave" class="form-control" asp-for="Clave" type="text" />
                        <span asp-validation-for="Clave" class="text-danger"></span>
                    </div>
                    <div class="col-md-3">
                        <label for="APaterno" class="form-label">Apellido Paterno</label>
                        <input id="APaterno" class="form-control" asp-for="APaterno" type="text" />
                        <span asp-validation-for="APaterno" class="text-danger"></span>
                    </div>
                    <div class="col-md-3">
                        <label for="AMaterno" class="form-label">Apellido Materno</label>
                        <input id="AMaterno" class="form-control" asp-for="AMaterno" type="text" />
                        <span asp-validation-for="AMaterno" class="text-danger"></span>
                    </div>
                    <div class="col-md-3">
                        <label for="Nombre" class="form-label">Nombre</label>
                        <input id="Nombre" class="form-control" asp-for="Nombre" type="text" />
                        <span asp-validation-for="Nombre" class="text-danger"></span>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-3">
                        <label for="FNacimiento" class="form-label">Fecha de Nacimiento</label>
                        <input id="FNacimiento" class="form-control" asp-for="FNacimiento" type="date" />
                        <span asp-validation-for="FNacimiento" class="text-danger"></span>
                    </div>
                    <div class="col-md-2">
                        <label asp-for="Sexo" class="form-label"></label>
                        <select asp-for="Sexo" class="form-control" asp-items="Model.Sexos">
                            <option value="">Sexo</option>
                        </select>
                        <span asp-validation-for="Sexo" class="text-danger"></span>
                    </div>
                    <div class="col-md-3">
                        <label for="Direccion" class="form-label">Dirección</label>
                        <input id="Direccion" class="form-control" asp-for="Direccion" type="text" />
                        <span asp-validation-for="Direccion" class="text-danger"></span>
                    </div>
                    <div class="col-md-2">
                        <label asp-for="Correo" class="form-label"></label>
                        <input id="Correo" class="form-control" asp-for="Correo" type="text" />
                        <span asp-validation-for="Correo" class="text-danger"></span>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-3">
                        <label asp-for="CURP" class="form-label"></label>
                        <input id="CURP" class="form-control" asp-for="CURP" type="text" />
                        <span asp-validation-for="CURP" class="text-danger"></span>
                    </div>
                    <div class="col-md-3">
                        <label asp-for="RFC" class="form-label"></label>
                        <input id="RFC" class="form-control" asp-for="RFC" type="text" />
                        <span asp-validation-for="RFC" class="text-danger"></span>
                    </div>
                    <div class="col-md-3">
                        <label asp-for="NSS" class="form-label"></label>
                        <input id="NSS" class="form-control" asp-for="NSS" type="text" />
                        <span asp-validation-for="NSS" class="text-danger"></span>
                    </div>
                    <div class="col-md-2">
                        <label asp-for="Estatus" class="form-label"></label>
                        <input id="Estatus" class="form-control" asp-for="Estatus" type="text" readonly />
                        <span asp-validation-for="Estatus" class="text-danger"></span>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-2">
                        <label asp-for="Nacionalidad" class="form-label"></label>
                        <select asp-for="Nacionalidad" class="form-control" asp-items="Model.Nacionalidades">
                            <option value="">Nacionalidad</option>
                        </select>
                        <span asp-validation-for="Nacionalidad" class="text-danger"></span>

                    </div>
                    <div class="col-md-2">
                        <label asp-for="Perfil" class="form-label"></label>
                        <select asp-for="Perfil" class="form-control" asp-items="Model.Perfiles">
                            <option value="">Perfil</option>
                        </select>
                        <span asp-validation-for="Perfil" class="text-danger"></span>

                    </div>
                    <div class="col-md-2">
                        <label asp-for="Experiencia" class="form-label"></label>
                        <select asp-for="Experiencia" class="form-control" asp-items="Model.Experiencias">
                            <option value="">Experiencia</option>
                        </select>
                        <span asp-validation-for="Experiencia" class="text-danger"></span>
                    </div>
                    <div class="col-md-2">
                        <label asp-for="Escolaridad" class="form-label"></label>
                        <select asp-for="Escolaridad" class="form-control" asp-items="Model.Escolaridades">
                            <option value="">Escolaridad</option>
                        </select>
                        <span asp-validation-for="Escolaridad" class="text-danger"></span>
                    </div>
                    <div class="col-md-2">
                        <label asp-for="EstadoCivil" class="form-label"></label>
                        <select asp-for="EstadoCivil" class="form-control" asp-items="Model.EstadoCiviles">
                            <option value="">EstadoCivil</option>
                        </select>
                        <span asp-validation-for="EstadoCivil" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </section>
        <section class="border shadow p-5 bg-gradient text-white" style="background-color: #133E87">
            <h4 class="mb-4">Detalle Entrevista</h4>
            <div class="row">
                <div class="col-md-2">
                    <label asp-for="Documento" class="form-label"></label>
                    <select asp-for="Documento" class="form-control" asp-items="Model.Documentos">
                        <option value="">Documento</option>
                    </select>
                    <span asp-validation-for="Documento" class="text-danger"></span>
                </div>
                <div class="col mb-3">
                    <div class="col">
                        <label asp-for="Observaciones" class="form-label"></label>
                        <input class="form-control w-100" asp-for="Observaciones" type="text" />
                        <span asp-validation-for="Observaciones" class="text-danger"></span>
                    </div>
                </div>
                <div class="col mb-3">
                    <div class="col">
                        <label asp-for="FIngreso" class="form-label"></label>
                        <input class="form-control w-100" asp-for="FIngreso" type="text" readonly/>
                        <span asp-validation-for="FIngreso" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col mt-4 mx-5 text-center">
                    <button type="submit" name="action" value="alta" class="btn btn-primary mb-3 px-3" style="width: 200px;">
                        <i class="bi bi-person-plus"></i> Alta
                    </button>
                    <button type="submit" name="action" value="baja" class="btn btn-danger mb-3 px-3" style="width: 200px;">
                        <i class="bi bi-person-dash"></i> Baja
                    </button>
                    <button type="submit" name="action" value="modificar" class="btn btn-light mb-3 px-3" style="width: 200px;">
                        <i class="bi bi-pencil-square"></i> Modificar
                    </button>
                    <button type="submit" name="action" value="restringir" class="btn btn-warning mb-3 px-3" style="width: 200px;">
                        <i class="bi bi-shield-lock"></i> Restringir
                    </button>
                </div>
            </div>
        </section>
    </form>
</main>

@section Scripts{
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("Clave").addEventListener("blur", function() {
                const clave = this.value;

                function formatFecha(fecha) {
                    if (!fecha) return '';
                    const date = new Date(fecha); // Convierte la cadena a un objeto Date

                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');  // Mes (01-12)
                    const day = String(date.getDate()).padStart(2, '0');  // Día (01-31)

                    return `${year}-${month}-${day}`; // Formato: YYYY-MM-DD
                }


                if (clave) {
                    fetch(`/MantenimientoBolsa/GetBolsaByClave?clave=${clave}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data) {
                                console.log(data);
                                // Rellena los campos con los datos obtenidos
                                document.getElementById("APaterno").value = data.aPaterno;
                                document.getElementById("AMaterno").value = data.aMaterno;
                                document.getElementById("Nombre").value = data.nombre;
                                document.getElementById("FNacimiento").value = formatFecha(data.fNacimiento);
                                document.getElementById("Direccion").value = data.direccion;
                                document.getElementById("Correo").value = data.correo;
                                document.getElementById("CURP").value = data.curp;

                                // Selecciona los valores en los dropdowns si existen
                                document.getElementById("Sexo").value = data.sexo;
                                document.getElementById("Nacionalidad").value = data.nacionalidad;
                                document.getElementById("Documentos").value = data.documentos;
                                document.getElementById("Perfil").value = data.perfil;
                                document.getElementById("Experiencia").value = data.experiencia;
                                document.getElementById("Escolaridad").value = data.escolaridad;
                                document.getElementById("EstadoCivil").value = data.estadoCivil;
                                document.getElementById("Observaciones").value = data.observaciones;
                                document.getElementById("FIngreso").value = formatFecha(data.fIngreso);
                                document.getElementById("Estatus").value = data.estatus;
                                document.getElementById("RFC").value = data.rfc;
                                document.getElementById("NSS").value = data.nss;

                            } else {

                            }
                        })
                        .catch(error => console.error('Error al obtener los datos:', error));
                }
            });
        });
    </script>

}